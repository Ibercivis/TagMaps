<!DOCTYPE html>
<html>
<head>
<style type="text/css">
circle.node {
  stroke: #999;
  stroke-width: 1.5px;
  stroke-opacity: .6;
}

line.link {
  stroke: #999;
  stroke-opacity: .6;
}

text.node {
  font-size: 9px ;
  font-family: sans-serif; 
  /*font: 2px sans-serif;*/
  fill: brown; /*SVG; CSS es color*/
  text-anchor: middle; /*svg 1.1.*/
}

div.gallery {
  border-style:dotted;
}

svg {
  border-style:solid;
}

</style>
<title>demo</title>
</head>
<body>
<p>
This document is in the wild only for test in different machines. Please do not refer to it as its final placement will change. 
<p>
<!-- cosas para un CMS: nav, footer, q, s, samp, section, details, summary, wbr
.... track kind=subtitles! 
<data value="1">One</data><!-- output, var 
Parece que todo el mundo usa un rate-slider del jquery.ui:
-->
<div class="gallery" id="chart" contextmenu="supermenu">
</div>
<div class="panel">
<!--see html5 command tag to define keyboard shortcuts-->
<!--see html5 menu tag to move the panel to a toolbar-->
<fieldset name="algoritmo">
Carga/Gravedad
<input disabled name="charge" type="range" min="1" max="11" value="9"/>
Distancia 
<input disabled name="distance" type="range" min="1" max="11" value="9"/>
<input disabled type="button" type="submit" value="heat"/>
</fieldset>
<fieldset name="filtrado">
fecha <input disabled type="date"/>
excluye grep <input disabled type="text">
<br/>
grado minimo <input disabled name="distance" type="range" min="1" max="11" value="9">
total edges  <input disabled name="distance" type="range" min="1" max="11" value="9">
<input disabled type="button" type="reset" value="Do"/>
</fieldset>
<fieldset name="visualizacion">
Grado min texto  <input disabled name="charge" type="range" min="1" max="11" value="9">
Tama&ntilde;o letra  <input disabled name="charge" type="range" min="1" max="11" value="9">
Zoom <input disabled name="charge" type="range" min="1" max="11" value="9"> 
<input disabled type="button" name="ResetZoom" text="ResetZ" type="reset" value="Reset"/> 
<input disabled type="button" value="Recargar" title="Recarga sin modificar los settings"/>
<input disabled type="checkbox" value="Auto"/> Actualiza cada 5 minutos
</fieldset>
<!--La idea es que estos settings manden informacion de vuelta a la base-->
<fieldset name="uxxxxserfs">
user controls
<menu id="supermenu">
<input disabled type="button" value="download image">
<input disabled type="button" value="share image">
</menu>
</fielset>
</div>


<script src="/libs/d3.v2.js"></script>
<!--"D3 is not a compatibility layer, so if your browser doesn't support 
//standards, you're out of luck."-->
<script>
//interesante http://en.wikipedia.org/wiki/Server-sent_events y <eventsource>
//http://www.html5rocks.com/en/tutorials/eventsource/basics/
//
//para probar esto en local con crome, lanzar con --allow-file-access-from-files
// d3.select("body").insert('div','div')  //inserta una div antes de la primera div :-D

   
// var force=d3.layout.force()
//     .charge(-30)
//     .linkDistance(20)
//     .size([900, 900]);

//
// Install the SVG chart and set properties
//


var svg = d3.select("#chart").append("svg:svg")   
      .attr("width", 900) .attr("height", 900)
      .append("svg:g")
      //.attr("transform","translate(-500,500) scale(1.3)")
      //.attr("pointer-events", "all")

svg.append("svg:rect")
  .attr("width", 900) .attr("height", 900)
  .attr("fill", "white")
  .attr("stroke","green")


var mizoom = d3.behavior.zoom()
      .scaleExtent([0.5,5.0]) // default is d3_behavior_zoomInfinity
      .on("zoom", function(){
            svg.attr("transform","translate(" + d3.event.translate[0] + "," +  d3.event.translate[1] + ") scale(" +  d3.event.scale + ")")
           });
        
svg.call(mizoom);


//
// Call the data
//
//



 d3.json('dataSpainMobile.json', function(datarray) {
  //console.log(datarray);
   nodes = [];  //nodos y links sin var, para que salgan de scope??
      nodes.indice=function(nombre){
         var res = -1 ;
         for (pos in this) {  
             if (this[pos].name==nombre) {res=parseInt(pos)}
            }
         return res
       }
     links = []; 
  for ( i in datarray) {
    val = datarray[i]
    if (val.value > 1) { 
      if (nodes.indice(val.key[0] )==-1) {nodes.push({name:val.key[0]})}
      if (nodes.indice(val.key[1] )==-1) {nodes.push({name:val.key[1]})}
      links.push({source:nodes.indice(val.key[0]),
                target:nodes.indice(val.key[1]),
                peso:val.value }) 
      } 
  };
 
   var force=d3.layout.force()
     .charge(-20)
     .linkDistance(40)
     .size([900, 900]);

  force.nodes(nodes).links(links).start();

  var link = svg.selectAll("line.link")
         .data(links)
         .enter().append("svg:line")
         .attr("class", "link")
         .style("stroke-width", function(d) { return Math.sqrt(d.peso); });
 
   var node = svg.selectAll("text.node")
       .data(nodes)
       .enter()
       .append("svg:text")
       .attr("class", "node")
       .text(function(d) { return d.name; }) 
       //.style("fill", function(d) { return "#432"; })
       .call(force.drag);
 
   node.append("title")
        .text(function(d) { return d.name; });
 
   force.on("tick", function() {
      link.attr("x1", function(d) { return d.source.x; })
         .attr("y1", function(d) { return d.source.y; })
         .attr("x2", function(d) { return d.target.x; })
         .attr("y2", function(d) { return d.target.y; });
     node.attr("x", function(d) { return d.x; })
         .attr("y", function(d) { return d.y; });
  }); 
 });
</script>





<details> <!-- open="open"-->
<p>Aqui iria la ayuda, de momento lo usamos para esconder
cachos de interface que no estan ni planteados</p>
<progress value="250" max="1000">
<span id="downloadProgress">25</span>%
</progress>
<meter min="0" max="800" value="400">50%</meter>
<menu>...</menu> <!--o quizas <select name y <option value, no?-->
</details>
</body>
</html>
