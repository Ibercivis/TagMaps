 while true; do ourselect="select from  mensaje where created_at > date(\"2012-06-18-$(date +%H:%M)\",\"yyyy-MM-dd-HH:mm\") and out.size() > 1"; time  curl -s -u admin:admin http://node3.ibercivis.es:2480/command/moSpain/gremlin -d "g.step{it.next().getRawGraph().query( new com.orientechnologies.orient.core.sql.query.OSQLSynchQuery('$ourselect'))}.scatter.transform{g.getVertex(it.getIdentity())}.sideEffect{x=it}.out.as('a').transform{x}.out.as('b').select(['a','b']).filter{it[0]<it[1]}.groupCount(){it.name}.cap().scatter.aggregate().cap().transform{groovy.json.JsonOutput.toJson(it)}" | grep -o = /tmp/result | wc -l ; sleep $[$RANDOM%15]; done
ourselect="select from index:dateidx where key between date(\"2012-06-18-$(date +%H:%M)\",\"yyyy-MM-dd-HH:mm\") and date(\"2012-06-19-$(date +%H:%M)\",\"yyyy-MM-dd-HH:mm\")"; time  curl -s -u admin:admin http://node3.ibercivis.es:2480/command/moSpain/gremlin -d "g.step{it.next().getRawGraph().query( new com.orientechnologies.orient.core.sql.query.OSQLSynchQuery('$ourselect'))}.scatter.transform{g.getVertex(it.field('rid'))}.count()"


ourselect="select from index:dateidx where key between date(\"2012-06-18-$(date +%H:%M)\",\"yyyy-MM-dd-HH:mm\") and date(\"2012-06-19-$(date +%H:%M)\",\"yyyy-MM-dd-HH:mm\")"; time  curl -s -u admin:admin http://node3.ibercivis.es:2480/command/moSpain/gremlin -d "g.step{it.next().getRawGraph().query( new com.orientechnologies.orient.core.sql.query.OSQLSynchQuery('$ourselect'))}.scatter.transform{new com.tinkerpop.blueprints.impls.orient.OrientVertex(g,it.field('rid'))}._.sideEffect{x=it}.out.as('a').transform{x}.out.as('b').select(['a','b']).filter{it[0]<it[1]}.groupCount(){it.name}.cap().scatter.aggregate().cap().transform{groovy.json.JsonOutput.toJson(it)}" | grep -o  value | wc -l

while true; do ourselect="select from  mensaje where created_at > date(\"2012-06-18-$(date +%H:%M)\",\"yyyy-MM-dd-HH:mm\") and not (out IS null)"; time  curl -s -u admin:admin http://node3.ibercivis.es:2480/command/moSpain/gremlin -d "g.step{it.next().getRawGraph().query( new com.orientechnologies.orient.core.sql.query.OSQLSynchQuery('$ourselect'))}.scatter.transform{g.getVertex(it.getIdentity())}.sideEffect{x=it}.filter{it.out.count()>1}.out.as('a').transform{x}.out.as('b').select(['a','b']).filter{it[0]<it[1]}.groupCount(){it.name}.cap()" > /tmp/result ; grep -o = /tmp/result | wc -l ; sleep $[$RANDOM%15]; done
